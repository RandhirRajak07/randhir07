# app.py
import streamlit as st
import pandas as pd
import requests
import folium
from streamlit_folium import st_folium
import matplotlib.pyplot as plt
from sklearn.linear_model import LinearRegression
import numpy as np

# --- API Setup ---
API_KEY = "your_openweathermap_api_key"
BASE_URL = "http://api.openweathermap.org/data/2.5/weather?"

# --- Function to get real-time weather ---
def get_weather(city):
    url = BASE_URL + f"q={city}&appid={API_KEY}&units=metric"
    response = requests.get(url).json()
    if response.get("main"):
        return {
            "city": city,
            "temperature": response["main"]["temp"],
            "humidity": response["main"]["humidity"],
            "weather": response["weather"][0]["description"],
            "lat": response["coord"]["lat"],
            "lon": response["coord"]["lon"]
        }
    else:
        return None

# --- Hero Section ---
st.markdown(
    """
    <div style="text-align:center; padding: 50px; background: linear-gradient(to right, #4f46e5, #9333ea); color: white; border-radius: 12px;">
        <h1 style="font-size: 3em;">🌦️ AI Weather Dashboard</h1>
        <p style="font-size: 1.2em;">Real-time weather, historical trends & AI-powered forecasts — all in one place.</p>
        <a href="#realtime"><button style="padding: 12px 24px; font-size: 1.1em; background: white; color: #4f46e5; border-radius: 8px; border: none; cursor: pointer;">Get Started</button></a>
    </div>
    """,
    unsafe_allow_html=True,
)

# --- Features Section ---
st.subheader("✨ Features")
col1, col2, col3 = st.columns(3)
with col1:
    st.markdown("🌍 **Real-Time Data**\n\nLive temperature, humidity, and conditions from OpenWeather API.")
with col2:
    st.markdown("📊 **Historical Trends**\n\nCharts & insights from past weather data.")
with col3:
    st.markdown("🔮 **AI Predictions**\n\nMachine learning forecasts for upcoming days.")

st.markdown("---")

# --- Real-Time Weather ---
st.subheader("🌍 Real-Time Weather")
city = st.text_input("Enter a city:", "Kathmandu")
if st.button("Get Weather", key="realtime"):
    data = get_weather(city)
    if data:
        st.success(f"Weather in {data['city']}: {data['weather']}, {data['temperature']}°C")
        st.write(f"💧 Humidity: {data['humidity']}%")

        # Map
        m = folium.Map(location=[data["lat"], data["lon"]], zoom_start=10)
        folium.Marker([data["lat"], data["lon"]], popup=data["city"]).add_to(m)
        st_folium(m, width=700, height=400)

st.markdown("---")

# --- Historical Trends ---
st.subheader("📈 Historical Weather Trends")
df = pd.DataFrame({
    "day": range(1, 11),
    "temp": np.random.randint(15, 30, 10)
})
st.line_chart(df.set_index("day"))

st.markdown("---")

# --- Predictions ---
st.subheader("🔮 AI Weather Predictions (Next 5 Days)")
X = np.array(df["day"]).reshape(-1, 1)
y = df["temp"]
model = LinearRegression().fit(X, y)
future_days = np.array(range(11, 16)).reshape(-1, 1)
preds = model.predict(future_days)

pred_df = pd.DataFrame({"day": range(11, 16), "pred_temp": preds})
st.line_chart(pred_df.set_index("day"))

st.write(pred_df)

st.markdown("---")

# --- Call to Action ---
st.markdown(
    """
    <div style="text-align:center; padding: 50px; background: linear-gradient(to right, #9333ea, #4f46e5); color: white; border-radius: 12px;">
        <h2 style="font-size: 2.5em;">🚀 Start Exploring Smarter Weather Insights</h2>
        <p style="font-size: 1.2em;">Whether you're a researcher, student, or just curious — explore real-time weather data & AI predictions today.</p>
        <a href="https://openweathermap.org/" target="_blank">
            <button style="padding: 14px 28px; font-size: 1.1em; background: white; color: #4f46e5; border-radius: 8px; border: none; cursor: pointer;">Get Your Free API Key</button>
        </a>
    </div>
    """,
    unsafe_allow_html=True,
)

# --- Footer ---
st.markdown(
    """
    <div style="text-align:center; padding: 20px; color: gray; font-size: 0.9em;">
        © 2025 AI Weather Dashboard. Built with ❤️ using Python & Streamlit.
    </div>
    """,
    unsafe_allow_html=True,
)

